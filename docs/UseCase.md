# **Use Case 정의서**

---

## **Use Case 1. 회원가입**

### **Actor**

- 비회원

### **기본 흐름**

1. 사용자가 회원가입 페이지에 접속한다
2. 사용자가 이메일, 닉네임, 비밀번호, 연락처를 입력한다
3. 시스템이 이메일/닉네임 중복을 검증한다
4. 시스템이 회원 정보를 저장한다
5. 시스템이 회원가입 완료 메시지를 표시한다

### **대안 흐름**

- **3a. 이메일이 중복된 경우**
    - “중복된 이메일 입니다.” 메시지를 표시한다
- **3b. 닉네임이 중복된 경우**
    - “이미 사용중인 닉네임 입니다.” 메시지를 표시한다
- **2a. 소셜 로그인(Google / Kakao) 선택 시**
    - OAuth2 인증 흐름으로 전환한다

### **사후 조건**

- 회원 정보가 ACTIVE 상태로 저장된다

---

## **Use Case 2. 경매 등록**

### **Actor**

- 판매자 (로그인된 회원)

### **사전 조건**

- 사용자가 로그인되어 있다

### **기본 흐름**

1. 판매자가 경매 등록 페이지에 접속한다
2. 판매자가 상품 정보를 입력한다
    - 상품명, 설명, 카테고리, 상태
3. 판매자가 상품 이미지를 업로드한다
4. 시스템이 이미지를 S3에 저장하고 CloudFront URL을 생성한다
5. 판매자가 경매 조건을 설정한다
    - 시작가, 즉시낙찰가, 종료시간
6. 시스템이 가격 유효성을 검증한다
    - 시작가 < 즉시낙찰가
    - 종료시간 > 현재시간
7. 시스템이 Product와 Auction을 생성한다
8. 시스템이 등록 완료 메시지를 표시한다

### **대안 흐름**

- **6a. 가격 조건이 유효하지 않은 경우**
    - 오류 메시지를 표시한다
- **6b. 종료시간이 현재보다 과거인 경우**
    - 오류 메시지를 표시한다

### **사후 조건**

- Product가 ACTIVE 상태로 저장된다
- Auction이 BEFORE_START 상태로 저장된다

---

## **Use Case 3. 입찰하기**

### **Actor**

- 입찰자 (로그인된 회원)

### **사전 조건**

- 사용자가 로그인되어 있다
- 경매가 ONGOING 상태이다
- 사용자가 해당 경매의 판매자가 아니다

### **기본 흐름**

1. 입찰자가 경매 상세 페이지에 접속한다
2. 시스템이 WebSocket 연결을 수립한다
3. 시스템이 현재 최고가와 입찰 내역을 표시한다
4. 입찰자가 입찰 금액을 입력하고 입찰 버튼을 클릭한다
5. 시스템이 Redis 분산락을 획득한다
6. 시스템이 입찰 금액을 검증한다
    - 현재가 < 입찰가 < 즉시낙찰가
7. 시스템이 Optimistic Lock으로 경매 정보를 갱신한다
8. 시스템이 입찰 내역을 저장한다
9. 시스템이 Redis 캐시를 갱신한다
10. 시스템이 Redis Pub/Sub로 입찰 이벤트를 발행한다
11. 시스템이 분산락을 해제한다
12. 모든 접속자에게 최신 입찰 정보가 브로드캐스트된다

### **대안 흐름**

- **5a. 분산락 획득 실패**
    - 재시도 또는 오류 메시지를 표시한다
- **6a. 입찰가가 현재가 이하인 경우**
    - 오류 메시지를 표시한다
- **7a. Optimistic Lock 충돌 발생**
    - 최신 정보 조회 후 재시도를 안내한다

### **사후 조건**

- Bid 내역이 저장된다
- Auction의 다음 정보가 갱신된다
    - current_price
    - current_bidder_id
    - bid_count

---

## **Use Case 4. 즉시구매**

### **Actor**

- 구매자 (로그인된 회원)

### **사전 조건**

- 사용자가 로그인되어 있다
- 경매가 ONGOING 상태이다
- 즉시낙찰가가 설정되어 있다

### **기본 흐름**

1. 구매자가 즉시구매 버튼을 클릭한다
2. 시스템이 즉시구매 확인 팝업을 표시한다
3. 구매자가 확인을 클릭한다
4. 시스템이 Redis 분산락을 획득한다
5. 시스템이 경매 상태를 재확인한다
6. 시스템이 즉시낙찰가로 Bid를 생성한다
    - bid_type = BUYOUT
7. 시스템이 Auction 상태를 ENDED로 변경한다
8. 시스템이 낙찰자 정보를 저장한다
9. 시스템이 Redis Pub/Sub로 경매 종료 이벤트를 발행한다
10. 시스템이 분산락을 해제한다
11. 모든 접속자에게 경매 종료가 브로드캐스트된다

### **대안 흐름**

- **5a. 경매가 이미 종료된 경우**
    - 오류 메시지를 표시한다
- **4a. 다른 사용자가 먼저 즉시구매한 경우**
    - 오류 메시지를 표시한다

### **사후 조건**

- Auction이 ENDED 상태로 변경된다
- 낙찰자가 확정된다

---

## **Use Case 5. 경매 자동 종료 (낙찰 처리)**

### **Actor**

- 시스템 (Scheduler)

### **사전 조건**

- 경매 종료 시간이 도래했다
- 경매가 ONGOING 상태이다

### **기본 흐름**

1. 스케줄러가 종료 시간이 지난 경매를 조회한다
2. 시스템이 최고 입찰자를 확인한다
3. 시스템이 Auction 상태를 ENDED로 변경한다
4. 시스템이 낙찰자 정보를 확정한다
5. 시스템이 Redis Pub/Sub로 경매 종료 이벤트를 발행한다

### **대안 흐름**

- **2a. 입찰자가 없는 경우**
    - 유찰 처리한다

### **사후 조건**

- Auction이 ENDED 상태로 변경된다
- 입찰자가 있으면 낙찰자가 확정된다

---

## **Use Case 6. 재경매 등록**

### **Actor**

- 판매자

### **사전 조건**

- 사용자가 로그인되어 있다
- 기존 경매가 ENDED 상태이다
- 해당 Product의 판매자이다

### **기본 흐름**

1. 판매자가 종료된 경매 상세 페이지에서 재경매 버튼을 클릭한다
2. 시스템이 기존 Product 정보를 불러온다
3. 판매자가 새로운 경매 조건을 설정한다
    - 시작가, 즉시낙찰가, 종료시간
4. 시스템이 동일 Product에 활성 경매가 없는지 확인한다
5. 시스템이 새로운 Auction을 생성한다
6. 시스템이 등록 완료 메시지를 표시한다

### **대안 흐름**

- **4a. 동일 Product에 진행 중인 경매가 있는 경우**
    - 오류 메시지를 표시한다

### **사후 조건**

- 동일 Product에 새로운 Auction이 생성된다
- 기존 Auction 이력은 유지된다

---

## **Use Case 7. 로그아웃**

### **Actor**

- 회원

### **사전 조건**

- 사용자가 로그인되어 있다

### **기본 흐름**

1. 회원이 로그아웃 버튼을 클릭한다
2. 시스템이 로그아웃 확인 팝업을 표시한다
3. 회원이 확인을 클릭한다
4. 시스템이 세션을 무효화한다
5. 시스템이 JWT 토큰을 삭제한다
6. 시스템이 메인 페이지로 리다이렉트한다

### **대안 흐름**

- **3a. 취소를 클릭한 경우**
    - 현재 페이지에 유지한다

### **사후 조건**

- 사용자 세션이 종료된다
- 인증 토큰이 삭제된다

---

## **Use Case 8. 경매 수정**

### **Actor**

- 판매자 (로그인된 회원)

### **사전 조건**

- 사용자가 로그인되어 있다
- 해당 경매의 판매자이다

### **기본 흐름**

1. 판매자가 자신의 경매 상세 페이지에서 수정 버튼을 클릭한다
2. 시스템이 경매 상태를 확인한다
3. 시스템이 수정 가능한 필드를 표시한다
4. 판매자가 정보를 수정한다
5. 시스템이 수정 내용을 검증한다
6. 시스템이 경매 정보를 갱신한다
7. 시스템이 수정 완료 메시지를 표시한다

### **대안 흐름**

- **2a. 경매가 BEFORE_START 상태인 경우**
    - 모든 필드 수정 가능 (상품 정보, 가격, 종료시간)
- **2b. 경매가 ONGOING 상태인 경우**
    - 제한적 수정 가능 (상품 설명, 이미지만 수정 가능)
    - 가격 및 종료시간 수정 불가
- **2c. 경매가 ENDED 상태인 경우**
    - 수정 불가 메시지를 표시한다
- **2d. 입찰이 이미 발생한 경우**
    - 가격 관련 정보 수정 불가 메시지를 표시한다

### **사후 조건**

- 경매 정보가 갱신된다
- 수정 이력이 기록된다 (선택사항)

---

## **Use Case 9. 경매 삭제**

### **Actor**

- 판매자 (로그인된 회원)

### **사전 조건**

- 사용자가 로그인되어 있다
- 해당 경매의 판매자이다

### **기본 흐름**

1. 판매자가 자신의 경매 상세 페이지에서 삭제 버튼을 클릭한다
2. 시스템이 삭제 확인 팝업을 표시한다
3. 판매자가 확인을 클릭한다
4. 시스템이 입찰 내역을 확인한다
5. 시스템이 Auction을 삭제한다
6. 시스템이 Product 상태를 갱신한다
7. 시스템이 삭제 완료 메시지를 표시하고 목록 페이지로 이동한다

### **대안 흐름**

- **4a. 입찰이 이미 발생한 경우**
    - "입찰이 발생한 경매는 삭제할 수 없습니다" 메시지를 표시한다
    - 삭제를 취소한다
- **4b. 경매가 ENDED 상태인 경우**
    - 물리적 삭제 대신 논리적 삭제 처리한다
    - Auction 상태를 DELETED로 변경한다

### **사후 조건**

- 입찰이 없는 경우: Auction이 삭제된다
- 입찰이 있는 경우: 삭제가 거부된다

---

## **Use Case 10. 경매 연장**

### **Actor**

- 판매자 (로그인된 회원)

### **사전 조건**

- 사용자가 로그인되어 있다
- 해당 경매의 판매자이다
- 경매가 ONGOING 상태이다
- 경매 종료 임박 (예: 1시간 이내)

### **기본 흐름**

1. 판매자가 경매 상세 페이지에서 연장 버튼을 클릭한다
2. 시스템이 연장 가능 여부를 확인한다
3. 시스템이 연장 시간 선택 옵션을 표시한다
    - 1시간, 3시간, 6시간, 12시간, 24시간
4. 판매자가 연장 시간을 선택하고 확인을 클릭한다
5. 시스템이 Redis 분산락을 획득한다
6. 시스템이 경매 종료 시간을 연장한다
7. 시스템이 Redis Pub/Sub로 연장 이벤트를 발행한다
8. 시스템이 분산락을 해제한다
9. 모든 접속자에게 연장 정보가 브로드캐스트된다
10. 시스템이 연장 완료 메시지를 표시한다

### **대안 흐름**

- **2a. 경매 종료까지 1시간 이상 남은 경우**
    - "종료 임박 시에만 연장 가능합니다" 메시지를 표시한다
- **2b. 연장 횟수 제한을 초과한 경우**
    - "연장 횟수를 초과했습니다" 메시지를 표시한다
- **5a. 분산락 획득 실패**
    - 재시도 또는 오류 메시지를 표시한다

### **사후 조건**

- Auction의 end_time이 갱신된다
- 연장 횟수가 증가한다 (선택사항)
- 모든 참여자에게 연장 알림이 전달된다