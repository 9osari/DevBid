<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>My Auctions</title>
  <link href="/css/theme.css" rel="stylesheet">
</head>
<body>

<h2>My Auctions</h2>

<div th:if="${auctions != null and !auctions.isEmpty()}">
  <table border="1">
    <thead>
      <tr>
        <th>ID</th>
        <th>이미지</th>
        <th>상품명</th>
        <th>시작가</th>
        <th>현재가</th>
        <th>즉시 구매가</th>
        <th>입찰 수</th>
        <th>상태</th>
        <th>시작 시간</th>
        <th>종료 시간</th>
        <th>판매자</th>
      </tr>
    </thead>
    <tbody>
      <tr th:each="auction : ${auctions}">
        <td th:text="${auction.id()}">1</td>
        <td>
          <img th:if="${auction.mainImageUrl() != null}"
               th:src="${auction.mainImageUrl()}"
               alt="상품 이미지"
               style="width: 100px; height: 100px; object-fit: cover;">
          <div th:unless="${auction.mainImageUrl() != null}"
               style="width: 100px; height: 100px; background: #eee; display: flex; align-items: center; justify-content: center; font-size: 12px;">
            No Image
          </div>
        </td>
        <td>
          <a th:href="@{/auctions/{id}/detail(id=${auction.id()})}"
             th:text="${auction.productName()}">상품명</a>
        </td>
        <td th:text="${#numbers.formatDecimal(auction.startingPrice, 0, 'COMMA', 0, 'POINT')} + '원'">1,000,000원</td>
        <td th:text="${#numbers.formatDecimal(auction.currentPrice, 0, 'COMMA', 0, 'POINT')} + '원'">1,000,000원</td>
        <td th:text="${#numbers.formatDecimal(auction.buyoutPrice, 0, 'COMMA', 0, 'POINT')} + '원'">2,000,000원</td>
        <td th:text="${auction.bidCount}">0</td>
        <td th:text="${auction.status()}">ONGOING</td>
        <td th:text="${#temporals.format(auction.startTime, 'yyyy-MM-dd HH:mm')}">시작 시간</td>
        <td th:text="${#temporals.format(auction.endTime, 'yyyy-MM-dd HH:mm')}">종료 시간</td>
        <td th:text="${auction.sellerName()}">판매자</td>
      </tr>
    </tbody>
  </table>


  <!-- 페이징 네비게이션 -->
  <div class="pagination" th:if="${totalPages > 1}" style="margin-top: 20px; text-align: center;">
    <!-- 이전 페이지 -->
    <a th:if="${currentPage > 0}"
       th:href="@{/auctions/my(page=${currentPage - 1}, size=10)}"
       th:text="'이전'">이전</a>
    <span th:if="${currentPage == 0}" class="disabled">이전</span>

    <!-- 첫 페이지 -->
    <a th:if="${currentPage > 2}"
       th:href="@{/auctions/my(page=0, size=10)}"
       th:text="1">1</a>
    <span th:if="${currentPage > 3}">...</span>

    <!-- 현재 페이지 기준 앞뒤 2개만 보여주기 -->
    <span th:each="i : ${#numbers.sequence(
        (currentPage - 2 > 0 ? currentPage - 2 : 0),
        (currentPage + 2 < totalPages - 1 ? currentPage + 2 : totalPages - 1)
    )}">
        <a th:if="${i != currentPage}"
           th:href="@{/auctions/my(page=${i}, size=10)}"
           th:text="${i + 1}"></a>
        <span th:if="${i == currentPage}"
              class="current"
              th:text="${i + 1}"
              style="font-weight:bold; color:blue;"></span>
    </span>

    <!-- 마지막 페이지 -->
    <span th:if="${currentPage < totalPages - 4}">...</span>
    <a th:if="${currentPage < totalPages - 3}"
       th:href="@{/auctions/my(page=${totalPages - 1}, size=10)}"
       th:text="${totalPages}">마지막</a>

    <!-- 다음 페이지 -->
    <a th:if="${currentPage < totalPages - 1}"
       th:href="@{/auctions/my(page=${currentPage + 1}, size=10)}"
       th:text="'다음'">다음</a>
    <span th:if="${currentPage >= totalPages - 1}" class="disabled">다음</span>
  </div>

  <p>Total Auctions: <span th:text="${totalItems}">0</span></p>
</div>

<div th:if="${auctions == null or auctions.isEmpty()}">
  <p>등록된 경매가 없습니다.</p>
</div>

<div>
    <p><a href="/">home</a></p>
    <p><a href="/auctionMain">auctionMain</a></p>
    <p><a href="/logout">logout</a></p>
</div>
</body>
</html>