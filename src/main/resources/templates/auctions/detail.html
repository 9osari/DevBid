<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${auction.productName} + ' - ê²½ë§¤ ìƒì„¸'">ê²½ë§¤ ìƒì„¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/theme.css" rel="stylesheet">
</head>
<body>

<div class="container mt-4">
    <h1 th:text="${auction.productName}">ìƒí’ˆëª…</h1>

    <div class="row mt-4">
        <!-- ì¢Œì¸¡: ìƒí’ˆ ì •ë³´ -->
        <div class="col-lg-6">
            <h3>Product Info</h3>
            <div class="info-box">
                <!-- ë©”ì¸ ì´ë¯¸ì§€ -->
                <div class="mb-3">
                    <img th:if="${auction.mainImageUrl() != null}"
                         th:src="${auction.mainImageUrl()}"
                         alt="ìƒí’ˆ ë©”ì¸ ì´ë¯¸ì§€"
                         style="width: 100%; max-height: 400px; object-fit: contain; border: 1px solid #888;">
                    <div th:unless="${auction.mainImageUrl() != null}" class="placeholder-box">
                        [ì´ë¯¸ì§€ ì—†ìŒ]
                    </div>
                </div>

                <!-- ì„œë¸Œ ì´ë¯¸ì§€ë“¤ (ë©”ì¸ ì´ë¯¸ì§€ í¬í•¨) -->
                <div th:if="${auction.mainImageUrl() != null or (auction.subImageUrls() != null and !auction.subImageUrls().isEmpty())}"
                     class="d-flex gap-2 mb-3" style="overflow-x: auto;">
                    <!-- ë©”ì¸ ì´ë¯¸ì§€ ì¸ë„¤ì¼ ì¶”ê°€ -->
                    <img th:if="${auction.mainImageUrl() != null}"
                         th:src="${auction.mainImageUrl()}"
                         alt="ë©”ì¸ ì´ë¯¸ì§€"
                         style="width: 80px; height: 80px; object-fit: cover; border: 2px solid #000; cursor: pointer;"
                         onclick="changeMainImage(this.src)"
                         title="ë©”ì¸ ì´ë¯¸ì§€">

                    <!-- ì„œë¸Œ ì´ë¯¸ì§€ë“¤ -->
                    <img th:each="subImageUrl : ${auction.subImageUrls()}"
                         th:src="${subImageUrl}"
                         alt="ìƒí’ˆ ì„œë¸Œ ì´ë¯¸ì§€"
                         style="width: 80px; height: 80px; object-fit: cover; border: 1px solid #888; cursor: pointer;"
                         onclick="changeMainImage(this.src)">
                </div>


                <p><strong>ìƒí’ˆëª…:</strong> <span th:text="${auction.productName}">ìƒí’ˆëª…</span></p>
                <hr>
                <p><strong>ìƒí’ˆ ìƒì„¸ ì„¤ëª…</strong></p>
                <div style="max-height: 250px; overflow-y:auto; border:1px solid #ccc; padding:8px; background:#fff;">
                    <p th:utext="${auction.description}">
                        ìƒí’ˆ ìƒì„¸ ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                    </p>
                </div>
                <hr>
                <!-- íŒë§¤ì ì •ë³´ -->
                <div class="user-info-box seller-box">
                    <div class="user-details">
                        <div class="user-label">íŒë§¤ì</div>
                        <p class="user-name" th:text="${auction.sellerName()}">íŒë§¤ì</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ìš°ì¸¡: ê²½ë§¤ ì •ë³´ -->
        <div class="col-lg-6">
            <h3>Auction Info</h3>
            <div class="auction-section">
                <p><strong>ê²½ë§¤ ìƒíƒœ:</strong>
                    <span th:text="${auction.status}">ONGOING</span>
                </p>

                <!-- í˜„ì¬ ìµœê³  ì…ì°°ì ì •ë³´ -->
                <div class="user-info-box bidder-box" th:if="${auction.winnerName() != null and !auction.winnerName().isEmpty()}">
                    <div class="user-details">
                        <div class="user-label">ìµœê³  ì…ì°°ì</div>
                        <p class="user-name" th:text="${auction.winnerName()}">ì…ì°°ì</p>
                    </div>
                </div>

                <!-- ì…ì°°ìê°€ ì—†ëŠ” ê²½ìš° -->
                <div class="user-info-box" th:unless="${auction.winnerName() != null and !auction.winnerName().isEmpty()}">
                    <div class="user-details">
                        <div class="user-label">ìµœê³  ì…ì°°ì</div>
                        <p class="user-name no-bidder">ì•„ì§ ì…ì°°ìê°€ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                </div>

                <hr>

                <p><strong>í˜„ì¬ ì…ì°°ê°€:</strong>
                    <span class="price"
                          th:text="${#numbers.formatDecimal(auction.currentPrice, 0, 'COMMA', 0, 'POINT')} + 'ì›'">1,000,000ì›</span>
                </p>
                <p><strong>ì‹œì‘ ê°€ê²©:</strong>
                    <span th:text="${#numbers.formatDecimal(auction.startingPrice, 0, 'COMMA', 0, 'POINT')} + 'ì›'">100,000ì›</span>
                </p>
                <p><strong>ì¦‰ì‹œ êµ¬ë§¤ê°€:</strong>
                    <span class="text-success"
                          th:text="${#numbers.formatDecimal(auction.buyoutPrice, 0, 'COMMA', 0, 'POINT')} + 'ì›'">2,000,000ì›</span>
                </p>
                <p><strong>ì…ì°° íšŸìˆ˜:</strong> <span th:text="${auction.bidCount}">0</span> íšŒ</p>

                <hr>
                <p><strong>ì‹œì‘ ì‹œê°„:</strong>
                    <span th:text="${#temporals.format(auction.startTime, 'yyyy-MM-dd HH:mm')}"></span></p>
                <p><strong>ì¢…ë£Œ ì‹œê°„:</strong>
                    <span th:text="${#temporals.format(auction.endTime, 'yyyy-MM-dd HH:mm')}"></span></p>

                <!-- ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸ -->
                <div id="countdown-container" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
                     padding: 15px; margin: 15px 0; border-radius: 8px; text-align: center;
                     box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <div style="color: #fff; font-size: 12px; font-weight: bold; letter-spacing: 1px; margin-bottom: 5px;">
                        â° TIME REMAINING
                    </div>
                    <div id="countdown" style="color: #fff; font-size: 28px; font-weight: bold; font-family: 'Courier New', monospace; letter-spacing: 2px;">
                        ê³„ì‚° ì¤‘...
                    </div>
                    <div id="countdown-status" style="color: #ffe0e0; font-size: 11px; margin-top: 5px;">
                    </div>
                </div>

                <hr>
                <form th:action="@{/auction/bid/{auctionId}(auctionId=${auction.id})}" method="post" id="bidForm">
                    <label><strong>ì…ì°°ê°€ ì…ë ¥:</strong></label>
                    <input type="text" name="bidAmount" id="bidAmountInput" oninput="formatNumberInput(this)"
                           th:placeholder="${#numbers.formatDecimal(auction.currentPrice + 100, 0, 'COMMA', 0, 'POINT')} + 'ì› ì´ìƒ'"
                           required style="width:100%; padding: 8px; margin: 10px 0; font-size: 16px; border: 2px solid #ccc;">

                    <!-- ë¹ ë¥¸ ì…ì°° ë²„íŠ¼ë“¤ -->
                    <div style="display: flex; gap: 5px; margin-bottom: 10px; flex-wrap: wrap;">
                        <button type="button" class="quick-bid-btn" onclick="setQuickBid(10000, event)"
                                style="flex: 1; min-width: 80px; padding: 8px; background: #e3f2fd; border: 1px solid #2196F3;
                                       color: #1976D2; font-size: 12px; cursor: pointer; border-radius: 4px;">
                            +1ë§Œì›
                        </button>
                        <button type="button" class="quick-bid-btn" onclick="setQuickBid(50000, event)"
                                style="flex: 1; min-width: 80px; padding: 8px; background: #e3f2fd; border: 1px solid #2196F3;
                                       color: #1976D2; font-size: 12px; cursor: pointer; border-radius: 4px;">
                            +5ë§Œì›
                        </button>
                        <button type="button" class="quick-bid-btn" onclick="setQuickBid(100000, event)"
                                style="flex: 1; min-width: 80px; padding: 8px; background: #e3f2fd; border: 1px solid #2196F3;
                                       color: #1976D2; font-size: 12px; cursor: pointer; border-radius: 4px;">
                            +10ë§Œì›
                        </button>
                        <button type="button" class="quick-bid-btn" onclick="setQuickBid(500000, event)"
                                style="flex: 1; min-width: 80px; padding: 8px; background: #e3f2fd; border: 1px solid #2196F3;
                                       color: #1976D2; font-size: 12px; cursor: pointer; border-radius: 4px;">
                            +50ë§Œì›
                        </button>
                    </div>

                    <input type="submit" value="ğŸ’° ì…ì°°í•˜ê¸°"
                           style="width: 100%; padding: 12px; font-size: 16px; font-weight: bold;
                                  background: #4CAF50; color: white; border: none; border-radius: 4px;
                                  cursor: pointer;">
                </form>

                <form th:action="@{/auction/buyout/{auctionId}(auctionId=${auction.id})}" method="post" class="mt-3">
                    <input type="submit" value="âš¡ ì¦‰ì‹œ êµ¬ë§¤í•˜ê¸°"
                           style="width: 100%; padding: 12px; font-size: 16px; font-weight: bold;
                                  background: #FF5722; color: white; border: none; border-radius: 4px;
                                  cursor: pointer;">
                </form>
            </div>
        </div>
    </div>

    <div class="text-center mt-4">
        <a href="/" class="btn btn-outline-secondary">í™ˆìœ¼ë¡œ</a>
    </div>
</div>

<script>
    function changeMainImage(src) {
        const mainImg = document.querySelector('img[alt="ìƒí’ˆ ë©”ì¸ ì´ë¯¸ì§€"]');
        if (mainImg) {
            mainImg.src = src;
        }
    }

    const currentPrice = Number(/*[[${auction.currentPrice}]]*/ 0);

    // ë¹ ë¥¸ ì…ì°° ë²„íŠ¼ í´ë¦­ ì‹œ
    function setQuickBid(amount, event) {
        const input = document.getElementById('bidAmountInput');
        let currentValue = Number(input.value.replace(/,/g, '')) || currentPrice;
        const newValue = currentValue + amount;

        // ì½¤ë§ˆ í¬ë§· ì ìš©
        input.value = newValue.toLocaleString('ko-KR');

        // ë²„íŠ¼ í´ë¦­ íš¨ê³¼
        event.target.style.transform = 'scale(0.95)';
        setTimeout(() => {
            event.target.style.transform = 'scale(1)';
        }, 100);
    }

    // ìˆ«ìì— ì½¤ë§ˆ ì¶”ê°€
    function formatNumberInput(input) {
        let value = input.value.replace(/,/g, ''); // ì½¤ë§ˆ ì œê±°
        if (value && !isNaN(value)) {
            input.value = Number(value).toLocaleString('ko-KR');
        }
    }

    document.getElementById('bidForm').addEventListener('submit', function(e) {
        const input = document.getElementById('bidAmountInput');
        // ì½¤ë§ˆ ì œê±°í•˜ê³  ìˆœìˆ˜ ìˆ«ìë§Œ ë‚¨ê¹€
        input.value = input.value.replace(/,/g, '');
    });

    // ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸
    function startCountdown() {
        const endTimeStr = '[[${auction.endTime}]]';
        if (!endTimeStr) return;

        const endTime = new Date(endTimeStr).getTime();
        const countdownElement = document.getElementById('countdown');
        const containerElement = document.getElementById('countdown-container');
        const statusElement = document.getElementById('countdown-status');

        function updateCountdown() {
            const now = new Date().getTime();
            const distance = endTime - now;

            if (distance < 0) {
                countdownElement.innerHTML = "ê²½ë§¤ ì¢…ë£Œ";
                statusElement.innerHTML = "ì…ì°°ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤";
                containerElement.style.background = "linear-gradient(135deg, #757575 0%, #616161 100%)";
                clearInterval(countdownInterval);

                // ì…ì°° í¼ ë¹„í™œì„±í™”
                document.getElementById('bidForm').innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">ê²½ë§¤ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</p>';
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            // ì‹œê°„ í¬ë§·íŒ…
            let timeString = '';
            if (days > 0) {
                timeString = `${days}ì¼ ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                statusElement.innerHTML = "ì¶©ë¶„í•œ ì‹œê°„ì´ ë‚¨ì•˜ìŠµë‹ˆë‹¤";
            } else if (hours > 0) {
                timeString = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                if (hours < 3) {
                    containerElement.style.background = "linear-gradient(135deg, #ff9800 0%, #f57c00 100%)";
                    statusElement.innerHTML = "âš ï¸ ë§ˆê°ì´ ì„ë°•í–ˆìŠµë‹ˆë‹¤!";
                } else {
                    statusElement.innerHTML = "ì„œë‘˜ëŸ¬ ì…ì°°í•˜ì„¸ìš”";
                }
            } else {
                timeString = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                containerElement.style.background = "linear-gradient(135deg, #f44336 0%, #d32f2f 100%)";
                statusElement.innerHTML = "ğŸ”¥ ê¸´ê¸‰! ê³§ ë§ˆê°ë©ë‹ˆë‹¤!";

                // 1ë¶„ ë¯¸ë§Œì¼ ë•Œ ê¹œë¹¡ì„ íš¨ê³¼
                if (minutes < 1) {
                    countdownElement.style.animation = 'blink 1s infinite';
                    statusElement.innerHTML = "ğŸš¨ ë§ˆì§€ë§‰ ê¸°íšŒ!";
                }
            }

            countdownElement.innerHTML = timeString;
        }

        // ì¦‰ì‹œ ì‹¤í–‰
        updateCountdown();

        // 1ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
        const countdownInterval = setInterval(updateCountdown, 1000);
    }

    // ê¹œë¹¡ì„ ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ ìŠ¤íƒ€ì¼ ì¶”ê°€
    const style = document.createElement('style');
    style.textContent = `
        @keyframes blink {
            0%, 50% { opacity: 1; }
            25%, 75% { opacity: 0.3; }
        }
        .quick-bid-btn:hover {
            background: #2196F3 !important;
            color: white !important;
            transform: translateY(-2px);
            transition: all 0.2s;
        }
        input[type="submit"]:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            transition: all 0.2s;
        }
    `;
    document.head.appendChild(style);

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
    window.addEventListener('DOMContentLoaded', startCountdown);
</script>

</body>
</html>